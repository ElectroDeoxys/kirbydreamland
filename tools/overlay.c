#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <stdbool.h>
#include <getopt.h>
#include <errno.h>

#include "common.h"

typedef unsigned char byte;

#define ROM_SIZE 0x40000

static void usage(void)
{
	fprintf(stderr, "Creates an overlay file to match the original ROM.\nUsage: overlay [-j] [-h] outfile\n");
}

struct Options {
	int japaneseROM;
	int help;
};

struct Options Options = {
	.japaneseROM = false,
	.help = false,
};

void get_args(int argc, char *argv[]) {
	for (int opt = 0; opt != -1;) {
		switch (opt = getopt(argc, argv, "jh:")) {
		case 'h':
			Options.help = true;
			break;
		case 'j':
			Options.japaneseROM = true;
			break;
		case 0:
		case -1:
			break;
		default:
			usage();
			exit(1);
			break;
		}
	}
}

struct StrayByte
{
    unsigned offset;
    byte val;
};

#define STRAY_BYTES_LEN 322

struct StrayByte strayBytes[STRAY_BYTES_LEN] = {
    {0x3fe2, (byte) 0x39},
    {0x3fe6, (byte) 0xef},
    {0x3fe7, (byte) 0xec},
    {0x3feb, (byte) 0xdf},
    {0x3fee, (byte) 0xba},
    {0x3fef, (byte) 0xfd},
    {0x3ff2, (byte) 0x5f},
    {0x3ff3, (byte) 0xfc},
    {0x3ff6, (byte) 0x7d},
    {0x3ffa, (byte) 0xfb},
    {0x3ffb, (byte) 0x43},
    {0x3ffe, (byte) 0x6d},
    {0x3fff, (byte) 0x00},
    {0x6bfd, (byte) 0x01},
    {0x6c60, (byte) 0x80},
    {0x7fe2, (byte) 0xc6},
    {0x7fe3, (byte) 0x01},
    {0x7fe6, (byte) 0x05},
    {0x7fea, (byte) 0xc1},
    {0x7feb, (byte) 0x80},
    {0x7fee, (byte) 0xc3},
    {0x7fef, (byte) 0xf3},
    {0x7ff2, (byte) 0x8a},
    {0x7ff3, (byte) 0xe8},
    {0x7ff6, (byte) 0x08},
    {0x7ff7, (byte) 0x98},
    {0x7ffa, (byte) 0x11},
    {0x7ffb, (byte) 0x10},
    {0x7ffe, (byte) 0x62},
    {0xffe2, (byte) 0x0f},
    {0xffe3, (byte) 0x01},
    {0xffe6, (byte) 0x8d},
    {0xffea, (byte) 0xc5},
    {0xffeb, (byte) 0x13},
    {0xffee, (byte) 0x86},
    {0xffef, (byte) 0xc4},
    {0xfff2, (byte) 0x90},
    {0xfff3, (byte) 0xad},
    {0xfff6, (byte) 0x23},
    {0xfff7, (byte) 0xc1},
    {0xfffa, (byte) 0x98},
    {0xfffb, (byte) 0xf3},
    {0xfffe, (byte) 0x24},
    {0x13891, (byte) 0x04},
    {0x138dc, (byte) 0x02},
    {0x138df, (byte) 0x20},
    {0x13999, (byte) 0x20},
    {0x1399f, (byte) 0x40},
    {0x13a1c, (byte) 0x80},
    {0x13a5f, (byte) 0x10},
    {0x13b1c, (byte) 0x10},
    {0x13b1f, (byte) 0x20},
    {0x13b5c, (byte) 0x80},
    {0x13b5f, (byte) 0xa4},
    {0x13d41, (byte) 0x01},
    {0x13dc3, (byte) 0x02},
    {0x13e0a, (byte) 0x40},
    {0x13e40, (byte) 0x02},
    {0x13e87, (byte) 0x08},
    {0x13f83, (byte) 0x02},
    {0x13fc3, (byte) 0x20},
    {0x13fcb, (byte) 0x08},
    {0x13ff4, (byte) 0xdf},
    {0x17afe, (byte) 0x04},
    {0x17b3f, (byte) 0x04},
    {0x17b7c, (byte) 0x02},
    {0x17bbd, (byte) 0x80},
    {0x17bfe, (byte) 0x02},
    {0x17c21, (byte) 0x08},
    {0x17d52, (byte) 0xfe},
    {0x17f2a, (byte) 0x04},
    {0x17f62, (byte) 0x01},
    {0x17fa8, (byte) 0x04},
    {0x1a782, (byte) 0x40},
    {0x1be43, (byte) 0x02},
    {0x1bf46, (byte) 0x20},
    {0x1bfc2, (byte) 0x80},
    {0x1bffb, (byte) 0xbf},
    {0x1dca0, (byte) 0x80},
    {0x1dea0, (byte) 0x80},
    {0x1e427, (byte) 0x80},
    {0x1e5da, (byte) 0xdf},
    {0x1e9bd, (byte) 0x10},
    {0x1eb3c, (byte) 0x02},
    {0x1ebb0, (byte) 0x80},
    {0x1ec16, (byte) 0x7f},
    {0x1ef62, (byte) 0x80},
    {0x1ef6f, (byte) 0x01},
    {0x1efef, (byte) 0x04},
    {0x1f462, (byte) 0x80},
    {0x1f7e3, (byte) 0x04},
    {0x1fb3f, (byte) 0x10},
    {0x1fea9, (byte) 0x04},
    {0x1ff20, (byte) 0x80},
    {0x1ff22, (byte) 0x02},
    {0x1ffaf, (byte) 0x08},
    {0x2395e, (byte) 0x02},
    {0x239df, (byte) 0x08},
    {0x23a9f, (byte) 0x01},
    {0x23be5, (byte) 0xdf},
    {0x23f43, (byte) 0x10},
    {0x23fcf, (byte) 0x01},
    {0x23fe2, (byte) 0xee},
    {0x23fe3, (byte) 0xbf},
    {0x23fe6, (byte) 0x7f},
    {0x23fe7, (byte) 0xdf},
    {0x23feb, (byte) 0xbe},
    {0x23fee, (byte) 0xf7},
    {0x23fef, (byte) 0xcf},
    {0x23ff2, (byte) 0x07},
    {0x23ff3, (byte) 0xfb},
    {0x23ff6, (byte) 0x2c},
    {0x23ff7, (byte) 0xed},
    {0x23ffb, (byte) 0xf8},
    {0x23ffe, (byte) 0xbb},
    {0x23fff, (byte) 0x00},
    {0x27762, (byte) 0x02},
    {0x2783c, (byte) 0x02},
    {0x27f2f, (byte) 0x20},
    {0x2bfe2, (byte) 0x66},
    {0x2bfe3, (byte) 0xf7},
    {0x2bfe6, (byte) 0x5f},
    {0x2bfe7, (byte) 0xdb},
    {0x2bfea, (byte) 0x7f},
    {0x2bfeb, (byte) 0xf7},
    {0x2bfee, (byte) 0xad},
    {0x2bfef, (byte) 0xde},
    {0x2bff2, (byte) 0xeb},
    {0x2bff3, (byte) 0x3d},
    {0x2bff6, (byte) 0xf3},
    {0x2bff7, (byte) 0x27},
    {0x2bffb, (byte) 0x7d},
    {0x2bffe, (byte) 0x3f},
    {0x2bfff, (byte) 0x00},
    {0x2e389, (byte) 0x90},
    {0x2e38a, (byte) 0x00},
    {0x2e38b, (byte) 0xfa},
    {0x2e38c, (byte) 0x70},
    {0x2e38d, (byte) 0x80},
    {0x2e38e, (byte) 0x00},
    {0x2e38f, (byte) 0xfa},
    {0x2e390, (byte) 0x70},
    {0x2e391, (byte) 0x70},
    {0x2e392, (byte) 0x00},
    {0x2e393, (byte) 0xfa},
    {0x2e394, (byte) 0x70},
    {0x2e395, (byte) 0x60},
    {0x2e396, (byte) 0x00},
    {0x2e397, (byte) 0xfa},
    {0x2e398, (byte) 0x70},
    {0x2e399, (byte) 0x50},
    {0x2e39a, (byte) 0x00},
    {0x2e39b, (byte) 0xfa},
    {0x2e39c, (byte) 0x70},
    {0x2e39d, (byte) 0x40},
    {0x2e39e, (byte) 0x00},
    {0x2e39f, (byte) 0xfa},
    {0x2e3a0, (byte) 0x70},
    {0x2e3a1, (byte) 0x30},
    {0x2e3a3, (byte) 0xfa},
    {0x2e3a4, (byte) 0x70},
    {0x2e3a5, (byte) 0x20},
    {0x2e3a7, (byte) 0xfa},
    {0x2e3a8, (byte) 0x70},
    {0x2e3a9, (byte) 0x10},
    {0x2e3ab, (byte) 0xfa},
    {0x2e3ac, (byte) 0x70},
    {0x2e3ad, (byte) 0x90},
    {0x2e3ae, (byte) 0xf8},
    {0x2e3af, (byte) 0xfa},
    {0x2e3b0, (byte) 0x10},
    {0x2e3b1, (byte) 0x80},
    {0x2e3b2, (byte) 0xf8},
    {0x2e3b3, (byte) 0xfa},
    {0x2e3b4, (byte) 0x10},
    {0x2e3b5, (byte) 0x70},
    {0x2e3b6, (byte) 0xf8},
    {0x2e3b7, (byte) 0xfa},
    {0x2e3b8, (byte) 0x10},
    {0x2e3b9, (byte) 0x60},
    {0x2e3ba, (byte) 0xf8},
    {0x2e3bb, (byte) 0xfa},
    {0x2e3bc, (byte) 0x10},
    {0x2e3bd, (byte) 0x50},
    {0x2e3be, (byte) 0xf8},
    {0x2e3bf, (byte) 0xfa},
    {0x2e3c0, (byte) 0x10},
    {0x2e3c1, (byte) 0x40},
    {0x2e3c2, (byte) 0xf8},
    {0x2e3c3, (byte) 0xfa},
    {0x2e3c4, (byte) 0x10},
    {0x2e3c5, (byte) 0x30},
    {0x2e3c6, (byte) 0xf8},
    {0x2e3c7, (byte) 0xfa},
    {0x2e3c8, (byte) 0x10},
    {0x2e3c9, (byte) 0x20},
    {0x2e3ca, (byte) 0xf8},
    {0x2e3cb, (byte) 0xfa},
    {0x2e3cc, (byte) 0x10},
    {0x2e3cd, (byte) 0x10},
    {0x2e3ce, (byte) 0xf8},
    {0x2e3cf, (byte) 0xfa},
    {0x2e3d0, (byte) 0x10},
    {0x2e3d1, (byte) 0x00},
    {0x2e3d2, (byte) 0x00},
    {0x2e3d3, (byte) 0xfa},
    {0x2e3d4, (byte) 0x70},
    {0x2e3d5, (byte) 0x00},
    {0x2e3d6, (byte) 0xf8},
    {0x2e3d7, (byte) 0xfa},
    {0x2e3d8, (byte) 0x11},
    {0x2e3d9, (byte) 0x90},
    {0x2e3da, (byte) 0xf8},
    {0x2e3db, (byte) 0xfa},
    {0x2e3dc, (byte) 0x50},
    {0x2e3dd, (byte) 0x80},
    {0x2e3de, (byte) 0xf8},
    {0x2e3df, (byte) 0xfa},
    {0x2e3e0, (byte) 0x50},
    {0x2e3e1, (byte) 0x70},
    {0x2e3e2, (byte) 0xf8},
    {0x2e3e3, (byte) 0xfa},
    {0x2e3e4, (byte) 0x50},
    {0x2e3e5, (byte) 0x60},
    {0x2e3e6, (byte) 0xf8},
    {0x2e3e7, (byte) 0xfa},
    {0x2e3e8, (byte) 0x50},
    {0x2e3e9, (byte) 0x50},
    {0x2e3ea, (byte) 0xf8},
    {0x2e3eb, (byte) 0xfa},
    {0x2e3ec, (byte) 0x50},
    {0x2e3ed, (byte) 0x40},
    {0x2e3ee, (byte) 0xf8},
    {0x2e3ef, (byte) 0xfa},
    {0x2e3f0, (byte) 0x50},
    {0x2e3f1, (byte) 0x30},
    {0x2e3f2, (byte) 0xf8},
    {0x2e3f3, (byte) 0xfa},
    {0x2e3f4, (byte) 0x50},
    {0x2e3f5, (byte) 0x20},
    {0x2e3f6, (byte) 0xf8},
    {0x2e3f7, (byte) 0xfa},
    {0x2e3f8, (byte) 0x50},
    {0x2e3f9, (byte) 0x10},
    {0x2e3fa, (byte) 0xf8},
    {0x2e3fb, (byte) 0xfa},
    {0x2e3fc, (byte) 0x50},
    {0x2e3fd, (byte) 0x90},
    {0x2e3ff, (byte) 0xfa},
    {0x2e400, (byte) 0x30},
    {0x2e401, (byte) 0x80},
    {0x2e402, (byte) 0x00},
    {0x2e403, (byte) 0xfa},
    {0x2e404, (byte) 0x30},
    {0x2e405, (byte) 0x70},
    {0x2e406, (byte) 0x00},
    {0x2e407, (byte) 0xfa},
    {0x2e408, (byte) 0x30},
    {0x2e409, (byte) 0x60},
    {0x2e40a, (byte) 0x00},
    {0x2e40b, (byte) 0xfa},
    {0x2e40c, (byte) 0x30},
    {0x2e40d, (byte) 0x50},
    {0x2e40e, (byte) 0x00},
    {0x2e40f, (byte) 0xfa},
    {0x2e410, (byte) 0x30},
    {0x2e411, (byte) 0x40},
    {0x2e412, (byte) 0x00},
    {0x2e413, (byte) 0xfa},
    {0x2e414, (byte) 0x30},
    {0x2e415, (byte) 0x30},
    {0x2e416, (byte) 0x00},
    {0x2e417, (byte) 0xfa},
    {0x2e418, (byte) 0x30},
    {0x2e419, (byte) 0x20},
    {0x2e41a, (byte) 0x00},
    {0x2e41b, (byte) 0xfa},
    {0x2e41c, (byte) 0x30},
    {0x2e41d, (byte) 0x10},
    {0x2e41e, (byte) 0x00},
    {0x2e41f, (byte) 0xfa},
    {0x2e420, (byte) 0x30},
    {0x2e422, (byte) 0xf8},
    {0x2e423, (byte) 0xfa},
    {0x2e424, (byte) 0x50},
    {0x2e427, (byte) 0xfa},
    {0x2e428, (byte) 0x31},
    {0x2ffe2, (byte) 0x08},
    {0x2ffe3, (byte) 0x40},
    {0x2ffe6, (byte) 0x50},
    {0x2ffe7, (byte) 0xa4},
    {0x2ffea, (byte) 0x15},
    {0x2ffeb, (byte) 0x49},
    {0x2ffee, (byte) 0x05},
    {0x2ffef, (byte) 0x36},
    {0x2fff2, (byte) 0x50},
    {0x2fff3, (byte) 0x8f},
    {0x2fff6, (byte) 0x6b},
    {0x2fff7, (byte) 0x0c},
    {0x2fffa, (byte) 0xf0},
    {0x2fffb, (byte) 0x4d},
    {0x2fffe, (byte) 0x10},
    {0x37ae0, (byte) 0x01},
    {0x37ba0, (byte) 0x02},
    {0x37e38, (byte) 0x01},
    {0x3f2bf, (byte) 0x08},
    {0x3fa7d, (byte) 0x02},
    {0x3ffe2, (byte) 0x18},
    {0x3ffe3, (byte) 0x85},
    {0x3ffe6, (byte) 0x21},
    {0x3ffe7, (byte) 0x09},
    {0x3ffea, (byte) 0x41},
    {0x3ffeb, (byte) 0x33},
    {0x3ffee, (byte) 0x83},
    {0x3ffef, (byte) 0x4c},
    {0x3fff2, (byte) 0xd8},
    {0x3fff3, (byte) 0x51},
    {0x3fff6, (byte) 0x33},
    {0x3fff7, (byte) 0x02},
    {0x3fffa, (byte) 0x90},
    {0x3fffb, (byte) 0x74},
    {0x3fffe, (byte) 0x14}
};

#define STRAY_BYTES_JP_LEN 395

struct StrayByte strayBytesJp[STRAY_BYTES_JP_LEN] = {
    {0x3fe2, (byte) 0x39},
    {0x3fe6, (byte) 0xef},
    {0x3fe7, (byte) 0xec},
    {0x3feb, (byte) 0x5f},
    {0x3fee, (byte) 0xfa},
    {0x3fef, (byte) 0xfd},
    {0x3ff2, (byte) 0xdf},
    {0x3ff3, (byte) 0xfd},
    {0x3ff6, (byte) 0x7d},
    {0x3ffa, (byte) 0xfb},
    {0x3ffb, (byte) 0x43},
    {0x3ffe, (byte) 0x6f},
    {0x3fff, (byte) 0x00},
    {0x5da0, (byte) 0x80},
    {0x6bfd, (byte) 0x01},
    {0x7a85, (byte) 0xdf},
    {0x7b3c, (byte) 0x01},
    {0x7b3f, (byte) 0x08},
    {0x7fe2, (byte) 0xc6},
    {0x7fe3, (byte) 0x01},
    {0x7fe6, (byte) 0x05},
    {0x7fea, (byte) 0xc1},
    {0x7feb, (byte) 0x80},
    {0x7fee, (byte) 0xc3},
    {0x7fef, (byte) 0xc2},
    {0x7ff2, (byte) 0x02},
    {0x7ff3, (byte) 0xe8},
    {0x7ff6, (byte) 0x08},
    {0x7ff7, (byte) 0x98},
    {0x7ffa, (byte) 0x11},
    {0x7ffb, (byte) 0x10},
    {0x7ffe, (byte) 0x62},
    {0xbff1, (byte) 0x7f},
    {0xbff9, (byte) 0xfb},
    {0xffe2, (byte) 0x0f},
    {0xffe3, (byte) 0x01},
    {0xffe6, (byte) 0x8d},
    {0xffea, (byte) 0xc4},
    {0xffeb, (byte) 0x13},
    {0xffee, (byte) 0x86},
    {0xffef, (byte) 0xc4},
    {0xfff2, (byte) 0x90},
    {0xfff3, (byte) 0x84},
    {0xfff6, (byte) 0x23},
    {0xfff7, (byte) 0x81},
    {0xfffa, (byte) 0x88},
    {0xfffb, (byte) 0xf3},
    {0x13777, (byte) 0x7f},
    {0x13891, (byte) 0x04},
    {0x138dc, (byte) 0x02},
    {0x138df, (byte) 0x20},
    {0x13999, (byte) 0x20},
    {0x1399f, (byte) 0x40},
    {0x139de, (byte) 0x08},
    {0x13a1c, (byte) 0x80},
    {0x13a50, (byte) 0x80},
    {0x13a5f, (byte) 0x10},
    {0x13a6a, (byte) 0xef},
    {0x13b1c, (byte) 0x10},
    {0x13b1f, (byte) 0x20},
    {0x13b5c, (byte) 0x82},
    {0x13b5e, (byte) 0x20},
    {0x13b5f, (byte) 0xa4},
    {0x13b97, (byte) 0x10},
    {0x13bd9, (byte) 0x08},
    {0x13bdf, (byte) 0x20},
    {0x13be5, (byte) 0xdf},
    {0x13bee, (byte) 0xcf},
    {0x13d41, (byte) 0x01},
    {0x13dc0, (byte) 0x80},
    {0x13dc3, (byte) 0x02},
    {0x13e0a, (byte) 0x40},
    {0x13e0f, (byte) 0x20},
    {0x13e40, (byte) 0x02},
    {0x13e43, (byte) 0x21},
    {0x13e87, (byte) 0x08},
    {0x13f0e, (byte) 0x04},
    {0x13f42, (byte) 0x80},
    {0x13f4a, (byte) 0x20},
    {0x13f4e, (byte) 0x02},
    {0x13f83, (byte) 0x02},
    {0x13fb5, (byte) 0xfb},
    {0x13fc0, (byte) 0x80},
    {0x13fc3, (byte) 0x20},
    {0x13fcb, (byte) 0x08},
    {0x13ff4, (byte) 0xdf},
    {0x13ff6, (byte) 0xfd},
    {0x17aba, (byte) 0x02},
    {0x17afe, (byte) 0x04},
    {0x17b30, (byte) 0x02},
    {0x17b3d, (byte) 0x04},
    {0x17b3f, (byte) 0x04},
    {0x17b7c, (byte) 0x02},
    {0x17bbd, (byte) 0x80},
    {0x17bf4, (byte) 0x04},
    {0x17bf8, (byte) 0x02},
    {0x17bfd, (byte) 0x0c},
    {0x17bfe, (byte) 0x02},
    {0x17bff, (byte) 0x01},
    {0x17c21, (byte) 0x08},
    {0x17c61, (byte) 0xa0},
    {0x17ceb, (byte) 0x04},
    {0x17d52, (byte) 0xfe},
    {0x17da0, (byte) 0x04},
    {0x17da3, (byte) 0x01},
    {0x17daf, (byte) 0x10},
    {0x17dd1, (byte) 0xfb},
    {0x17e59, (byte) 0xfd},
    {0x17e63, (byte) 0x04},
    {0x17e6f, (byte) 0x80},
    {0x17f2a, (byte) 0x04},
    {0x17f62, (byte) 0x01},
    {0x17fa8, (byte) 0x04},
    {0x17fec, (byte) 0x40},
    {0x1a782, (byte) 0x40},
    {0x1be43, (byte) 0x02},
    {0x1be8b, (byte) 0x10},
    {0x1bf46, (byte) 0x20},
    {0x1bf83, (byte) 0x01},
    {0x1bf8a, (byte) 0x80},
    {0x1bfc2, (byte) 0x80},
    {0x1bff1, (byte) 0xf7},
    {0x1bffb, (byte) 0xbf},
    {0x1dbf1, (byte) 0x08},
    {0x1dbfe, (byte) 0x40},
    {0x1dca0, (byte) 0x80},
    {0x1dd23, (byte) 0x02},
    {0x1dda3, (byte) 0x80},
    {0x1dea0, (byte) 0x80},
    {0x1e427, (byte) 0x80},
    {0x1e5da, (byte) 0xdf},
    {0x1e87c, (byte) 0x02},
    {0x1e8fc, (byte) 0x01},
    {0x1e9bd, (byte) 0x10},
    {0x1eb3c, (byte) 0x02},
    {0x1ebb0, (byte) 0x80},
    {0x1ebbe, (byte) 0x02},
    {0x1ebf5, (byte) 0x10},
    {0x1ec16, (byte) 0x7f},
    {0x1ec29, (byte) 0x40},
    {0x1ef21, (byte) 0x20},
    {0x1ef62, (byte) 0x80},
    {0x1ef6f, (byte) 0x01},
    {0x1efa3, (byte) 0x01},
    {0x1efe1, (byte) 0x08},
    {0x1efef, (byte) 0x04},
    {0x1f462, (byte) 0x80},
    {0x1f713, (byte) 0x7f},
    {0x1f7e3, (byte) 0x04},
    {0x1fb30, (byte) 0x80},
    {0x1fb3f, (byte) 0x10},
    {0x1fe2a, (byte) 0x20},
    {0x1fea3, (byte) 0x01},
    {0x1fea9, (byte) 0x04},
    {0x1fed5, (byte) 0xef},
    {0x1fee2, (byte) 0x40},
    {0x1ff20, (byte) 0x80},
    {0x1ff22, (byte) 0x02},
    {0x1ffaf, (byte) 0x08},
    {0x22fc3, (byte) 0x40},
    {0x232dd, (byte) 0x02},
    {0x2395e, (byte) 0x02},
    {0x239df, (byte) 0x08},
    {0x23a9f, (byte) 0x01},
    {0x23be5, (byte) 0xdf},
    {0x23f43, (byte) 0x12},
    {0x23fcf, (byte) 0x01},
    {0x23fe2, (byte) 0xee},
    {0x23fe3, (byte) 0xbf},
    {0x23fe6, (byte) 0x7f},
    {0x23fe7, (byte) 0xdf},
    {0x23feb, (byte) 0xbe},
    {0x23fee, (byte) 0xf7},
    {0x23fef, (byte) 0xef},
    {0x23ff2, (byte) 0x87},
    {0x23ff3, (byte) 0xdb},
    {0x23ff6, (byte) 0x2c},
    {0x23ff7, (byte) 0xed},
    {0x23ffb, (byte) 0xf8},
    {0x23ffe, (byte) 0xbb},
    {0x23fff, (byte) 0x00},
    {0x2783c, (byte) 0x02},
    {0x27b3f, (byte) 0x08},
    {0x27bff, (byte) 0x02},
    {0x27c62, (byte) 0x04},
    {0x27f2f, (byte) 0x20},
    {0x27fe1, (byte) 0x08},
    {0x2bd9d, (byte) 0x08},
    {0x2bfe2, (byte) 0x66},
    {0x2bfe3, (byte) 0xf7},
    {0x2bfe6, (byte) 0x5f},
    {0x2bfe7, (byte) 0xdf},
    {0x2bfea, (byte) 0x7f},
    {0x2bfeb, (byte) 0xf7},
    {0x2bfee, (byte) 0xed},
    {0x2bfef, (byte) 0xde},
    {0x2bff2, (byte) 0xeb},
    {0x2bff3, (byte) 0x3d},
    {0x2bff6, (byte) 0xf3},
    {0x2bff7, (byte) 0x23},
    {0x2bffb, (byte) 0x7d},
    {0x2bffe, (byte) 0x3f},
    {0x2bfff, (byte) 0x00},
    {0x2e389, (byte) 0x90},
    {0x2e38a, (byte) 0x00},
    {0x2e38b, (byte) 0xfa},
    {0x2e38c, (byte) 0x70},
    {0x2e38d, (byte) 0x80},
    {0x2e38e, (byte) 0x00},
    {0x2e38f, (byte) 0xfa},
    {0x2e390, (byte) 0x70},
    {0x2e391, (byte) 0x70},
    {0x2e392, (byte) 0x00},
    {0x2e393, (byte) 0xfa},
    {0x2e394, (byte) 0x70},
    {0x2e395, (byte) 0x60},
    {0x2e396, (byte) 0x00},
    {0x2e397, (byte) 0xfa},
    {0x2e398, (byte) 0x70},
    {0x2e399, (byte) 0x50},
    {0x2e39a, (byte) 0x00},
    {0x2e39b, (byte) 0xfa},
    {0x2e39c, (byte) 0x70},
    {0x2e39d, (byte) 0x40},
    {0x2e39e, (byte) 0x00},
    {0x2e39f, (byte) 0xfa},
    {0x2e3a0, (byte) 0x70},
    {0x2e3a1, (byte) 0x30},
    {0x2e3a3, (byte) 0xfa},
    {0x2e3a4, (byte) 0x70},
    {0x2e3a5, (byte) 0x20},
    {0x2e3a7, (byte) 0xfa},
    {0x2e3a8, (byte) 0x70},
    {0x2e3a9, (byte) 0x10},
    {0x2e3ab, (byte) 0xfa},
    {0x2e3ac, (byte) 0x70},
    {0x2e3ad, (byte) 0x90},
    {0x2e3ae, (byte) 0xf8},
    {0x2e3af, (byte) 0xfa},
    {0x2e3b0, (byte) 0x10},
    {0x2e3b1, (byte) 0x80},
    {0x2e3b2, (byte) 0xf8},
    {0x2e3b3, (byte) 0xfa},
    {0x2e3b4, (byte) 0x10},
    {0x2e3b5, (byte) 0x70},
    {0x2e3b6, (byte) 0xf8},
    {0x2e3b7, (byte) 0xfa},
    {0x2e3b8, (byte) 0x10},
    {0x2e3b9, (byte) 0x60},
    {0x2e3ba, (byte) 0xf8},
    {0x2e3bb, (byte) 0xfa},
    {0x2e3bc, (byte) 0x10},
    {0x2e3bd, (byte) 0x50},
    {0x2e3be, (byte) 0xf8},
    {0x2e3bf, (byte) 0xfa},
    {0x2e3c0, (byte) 0x10},
    {0x2e3c1, (byte) 0x40},
    {0x2e3c2, (byte) 0xf8},
    {0x2e3c3, (byte) 0xfa},
    {0x2e3c4, (byte) 0x10},
    {0x2e3c5, (byte) 0x30},
    {0x2e3c6, (byte) 0xf8},
    {0x2e3c7, (byte) 0xfa},
    {0x2e3c8, (byte) 0x10},
    {0x2e3c9, (byte) 0x20},
    {0x2e3ca, (byte) 0xf8},
    {0x2e3cb, (byte) 0xfa},
    {0x2e3cc, (byte) 0x10},
    {0x2e3cd, (byte) 0x10},
    {0x2e3ce, (byte) 0xf8},
    {0x2e3cf, (byte) 0xfa},
    {0x2e3d0, (byte) 0x10},
    {0x2e3d1, (byte) 0x00},
    {0x2e3d2, (byte) 0x00},
    {0x2e3d3, (byte) 0xfa},
    {0x2e3d4, (byte) 0x70},
    {0x2e3d5, (byte) 0x00},
    {0x2e3d6, (byte) 0xf8},
    {0x2e3d7, (byte) 0xfa},
    {0x2e3d8, (byte) 0x11},
    {0x2e3d9, (byte) 0x90},
    {0x2e3da, (byte) 0xf8},
    {0x2e3db, (byte) 0xfa},
    {0x2e3dc, (byte) 0x50},
    {0x2e3dd, (byte) 0x80},
    {0x2e3de, (byte) 0xf8},
    {0x2e3df, (byte) 0xfa},
    {0x2e3e0, (byte) 0x50},
    {0x2e3e1, (byte) 0x70},
    {0x2e3e2, (byte) 0xf8},
    {0x2e3e3, (byte) 0xfa},
    {0x2e3e4, (byte) 0x50},
    {0x2e3e5, (byte) 0x60},
    {0x2e3e6, (byte) 0xf8},
    {0x2e3e7, (byte) 0xfa},
    {0x2e3e8, (byte) 0x50},
    {0x2e3e9, (byte) 0x50},
    {0x2e3ea, (byte) 0xf8},
    {0x2e3eb, (byte) 0xfa},
    {0x2e3ec, (byte) 0x50},
    {0x2e3ed, (byte) 0x40},
    {0x2e3ee, (byte) 0xf8},
    {0x2e3ef, (byte) 0xfa},
    {0x2e3f0, (byte) 0x50},
    {0x2e3f1, (byte) 0x30},
    {0x2e3f2, (byte) 0xf8},
    {0x2e3f3, (byte) 0xfa},
    {0x2e3f4, (byte) 0x50},
    {0x2e3f5, (byte) 0x20},
    {0x2e3f6, (byte) 0xf8},
    {0x2e3f7, (byte) 0xfa},
    {0x2e3f8, (byte) 0x50},
    {0x2e3f9, (byte) 0x10},
    {0x2e3fa, (byte) 0xf8},
    {0x2e3fb, (byte) 0xfa},
    {0x2e3fc, (byte) 0x50},
    {0x2e3fd, (byte) 0x90},
    {0x2e3ff, (byte) 0xfa},
    {0x2e400, (byte) 0x30},
    {0x2e401, (byte) 0x80},
    {0x2e402, (byte) 0x00},
    {0x2e403, (byte) 0xfa},
    {0x2e404, (byte) 0x30},
    {0x2e405, (byte) 0x70},
    {0x2e406, (byte) 0x00},
    {0x2e407, (byte) 0xfa},
    {0x2e408, (byte) 0x30},
    {0x2e409, (byte) 0x60},
    {0x2e40a, (byte) 0x00},
    {0x2e40b, (byte) 0xfa},
    {0x2e40c, (byte) 0x30},
    {0x2e40d, (byte) 0x50},
    {0x2e40e, (byte) 0x00},
    {0x2e40f, (byte) 0xfa},
    {0x2e410, (byte) 0x30},
    {0x2e411, (byte) 0x40},
    {0x2e412, (byte) 0x00},
    {0x2e413, (byte) 0xfa},
    {0x2e414, (byte) 0x30},
    {0x2e415, (byte) 0x30},
    {0x2e416, (byte) 0x00},
    {0x2e417, (byte) 0xfa},
    {0x2e418, (byte) 0x30},
    {0x2e419, (byte) 0x20},
    {0x2e41a, (byte) 0x00},
    {0x2e41b, (byte) 0xfa},
    {0x2e41c, (byte) 0x30},
    {0x2e41d, (byte) 0x10},
    {0x2e41e, (byte) 0x00},
    {0x2e41f, (byte) 0xfa},
    {0x2e420, (byte) 0x30},
    {0x2e422, (byte) 0xf8},
    {0x2e423, (byte) 0xfa},
    {0x2e424, (byte) 0x50},
    {0x2e427, (byte) 0xfa},
    {0x2e428, (byte) 0x31},
    {0x2ffe2, (byte) 0x08},
    {0x2ffe3, (byte) 0x40},
    {0x2ffe6, (byte) 0x40},
    {0x2ffe7, (byte) 0x24},
    {0x2ffea, (byte) 0x15},
    {0x2ffeb, (byte) 0x49},
    {0x2ffee, (byte) 0x05},
    {0x2ffef, (byte) 0x30},
    {0x2fff2, (byte) 0x50},
    {0x2fff3, (byte) 0x8f},
    {0x2fff6, (byte) 0x63},
    {0x2fff7, (byte) 0x0c},
    {0x2fffa, (byte) 0xf0},
    {0x2fffb, (byte) 0x4d},
    {0x2fffe, (byte) 0x10},
    {0x37ae0, (byte) 0x01},
    {0x37ba0, (byte) 0x02},
    {0x37c04, (byte) 0xef},
    {0x37c23, (byte) 0x20},
    {0x37e20, (byte) 0x80},
    {0x37e38, (byte) 0x01},
    {0x37ef0, (byte) 0x80},
    {0x3f2bf, (byte) 0x08},
    {0x3fa7d, (byte) 0x02},
    {0x3ffe2, (byte) 0x18},
    {0x3ffe3, (byte) 0x85},
    {0x3ffe6, (byte) 0x21},
    {0x3ffe7, (byte) 0x09},
    {0x3ffea, (byte) 0x41},
    {0x3ffeb, (byte) 0x33},
    {0x3ffee, (byte) 0x83},
    {0x3ffef, (byte) 0x4c},
    {0x3fff2, (byte) 0xd8},
    {0x3fff3, (byte) 0x51},
    {0x3fff6, (byte) 0x33},
    {0x3fff7, (byte) 0x02},
    {0x3fffa, (byte) 0x90},
    {0x3fffb, (byte) 0x74},
    {0x3fffe, (byte) 0x14}
};

int main(int argc, char *argv[])
{
    get_args(argc, argv);
    argc -= optind;
    argv += optind;

    if (Options.help)
    {
        usage();
        return 0;
    }

    if (argc < 1)
    {
        usage();
        exit(1);
    }

    byte *fileBuffer = (byte*) malloc(ROM_SIZE * sizeof(byte));

    for (unsigned i = 0; i < ROM_SIZE / 0x40; i++)
    {
        // regions in ROM where pattern is swapped
        if ((i * 0x40 <= 0x00800)
         || (i * 0x40 >= 0x03800 && i * 0x40 <= 0x04000)
         || (i * 0x40 >= 0x0b800 && i * 0x40 <= 0x0c000)
         || (i * 0x40 >= 0x13000 && i * 0x40 <= 0x14000)
         || (i * 0x40 >= 0x1a000 && i * 0x40 <= 0x1a800)
         || (i * 0x40 >= 0x1b800 && i * 0x40 <= 0x1c000)
         || (i * 0x40 >= 0x22800 && i * 0x40 <= 0x23fff)
         || (i * 0x40 >= 0x2a800 && i * 0x40 <= 0x2b000)
         || (i * 0x40 >= 0x2b000 && i * 0x40 <= 0x2bfff)
         || (i * 0x40 >= 0x33800 && i * 0x40 <= 0x34000)
         || (i * 0x40 >= 0x3b800 && i * 0x40 <= 0x3c000))
        {
            memset(fileBuffer + (i * 0x40) + 0x00, 0x00, 0x20);
            memset(fileBuffer + (i * 0x40) + 0x20, 0xff, 0x20);
        }
        else
        {
            memset(fileBuffer + (i * 0x40) + 0x00, 0xff, 0x20);
            memset(fileBuffer + (i * 0x40) + 0x20, 0x00, 0x20);
        }
    }

    // take care of hardcoded stray bytes
    if (Options.japaneseROM)
    {
        for (unsigned i = 0; i < STRAY_BYTES_JP_LEN; i++)
            fileBuffer[strayBytesJp[i].offset] = strayBytesJp[i].val;
    }
    else
    {
        for (unsigned i = 0; i < STRAY_BYTES_LEN; i++)
            fileBuffer[strayBytes[i].offset] = strayBytes[i].val;
    }

    FILE *fi = fopen(argv[0], "wb");

    if (fi == NULL)
    {
        printf("Error: %d (%s)\n", errno, strerror(errno));
        exit(1);
    }

    fwrite(fileBuffer, sizeof(byte), ROM_SIZE, fi);
    fclose(fi);

    free(fileBuffer);

    return 0;
}
